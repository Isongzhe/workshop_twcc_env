# ==============================================================================
# INTAKE CATALOG FOR TAIWAN RADAR DATASETS
# ==============================================================================
# This catalog provides standardized access to Taiwan weather radar data with
# maximum reflectivity (MaxDBZ) measurements stored in Analysis-Ready format.
#
# Template Version: 1.0
# Last Updated: August 2025
# ==============================================================================

metadata:
  version: 1
  catalog_type: "radar_data"
  institution: "Taiwan Weather Research Institute"
  license: "Research Use"
  description: "Taiwan weather radar maximum reflectivity data"
  references:
    - "Taiwan Central Weather Administration"

sources:
  QPESUMS_tw:
    description: |
      Taiwan Weather Radar Maximum Reflectivity (MaxDBZ) Dataset
      
      This dataset contains 10+ years (2013-2023) of high-resolution weather radar 
      maximum reflectivity data covering Taiwan and surrounding waters. The data 
      provides continuous monitoring of precipitation systems and convective activity.
      
      Spatial Coverage:
      - Latitude: 20.0°N to 27.0°N (561 grid points)
      - Longitude: 118.0°E to 123.5°E (441 grid points) 
      - Horizontal Resolution: ~0.01° × ~0.0125° (~1.1 km × ~1.4 km)
      - Domain: Taiwan main island and surrounding coastal waters
      
      Temporal Coverage:
      - Period: 2013-01-01 to 2023-08-31
      - Frequency: 10-minute intervals
      - Total Time Steps: 558,420 observations
      - Data continuity: Nearly continuous with minimal gaps
      
      Data Variables:
      - MaxDBZ: Maximum radar reflectivity factor (dBZ)
        * Range: Typically 0-70 dBZ
        * Higher values indicate stronger precipitation
        * Composite maximum over all elevation angles
      
      Data Format: Multi-annual Zarr stores with Dask chunking
      Estimated Size: ~553GB total
      Chunk Strategy: Time-based chunking (1 time step per chunk)
      Processing Level: Analysis-ready, quality-controlled radar composites
    
    driver: zarr
    
    parameters:
      time_range:
        description: "Time range for data selection (YYYY-MM-DD format)"
        type: str
        default: null
      spatial_subset:
        description: "Spatial subset for analysis (lat/lon bounds)"
        type: list
        default: null
      min_reflectivity:
        description: "Minimum reflectivity threshold (dBZ)"
        type: float
        default: 0.0
    
    args:
      urlpath: 
        # - "/home/NAS/homes/sungche-10024/side_project/radar_process/data/QPESUMS_tw_MaxDBZ_2021.zarr" # local path
        - "/home/u7092712/Work/QPESUMS_tw/QPESUMS_tw_MaxDBZ_2021.zarr" # change to HFS path
    
    metadata:
      tags: ["radar", "taiwan", "MaxDBZ", "precipitation", "10min", "weather"]
      data_type: "gridded"
      domain: "atmospheric"
      grid_type: "regular_lat_lon"
      institution: "Taiwan Weather Research"
      source: "Weather Radar Network"
      processing_level: "analysis_ready"
      coordinate_system: "WGS84"
      
      # Data quality and processing information
      quality_flags:
        - "quality_controlled"
        - "composite_maximum"
        - "zarr_optimized" 
        - "dask_compatible"
        - "analysis_ready"
      
      # Usage guidelines
      usage_notes: |
        - Data represents maximum reflectivity composite from multiple radar sites
        - 10-minute temporal resolution ideal for convective storm analysis
        - Use time slicing for memory-efficient loading: ds.sel(time=slice('2020-01-01', '2020-12-31'))
        - Higher dBZ values (>40) typically indicate heavy precipitation
        - Values below 10 dBZ may represent light precipitation or noise
      
      limitations:
        - "Radar data quality depends on atmospheric conditions"
        - "Possible beam blockage effects in mountainous regions"
        - "Ground clutter may affect low-level observations"
        - "Data gaps possible during radar maintenance periods"
      
      # Example usage
      example_code: |
        import intake
        import xarray as xr
        
        # Load catalog
        catalog = intake.open_catalog('radar_intake_catalog.yaml')
        
        # Load full dataset
        ds = catalog.QPSUMS_tw.to_dask()
        
        # Load subset (recommended for memory efficiency)
        ds_subset = ds.sel(
            time=slice('2020-07-01', '2020-07-31'),
            latitude=slice(23, 25),
            longitude=slice(120, 122)
        )
        
        # Filter for significant precipitation
        heavy_rain = ds.MaxDBZ.where(ds.MaxDBZ > 30)  # >30 dBZ reflectivity

